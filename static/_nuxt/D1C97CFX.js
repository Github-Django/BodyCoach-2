import{r as c,bS as E,U as b,u as K,F as i,ah as m,ag as L,ai as N}from"./BcqZkZus.js";const F=Symbol("multi-step-form-context");function T(a){const f=c(E(b(a.initialState))),r=c({message:"",fields:{}}),g=K(),o=c(!1),v=c(!1),u=i(()=>a.steps.map((e,t)=>({...e,id:t}))),p=i(()=>u.value.length),x=i(()=>(n.value+1)/p.value*100),n=i(()=>u.value.find(e=>e.to===g.currentRoute.value.path)?.id??0),h=i(()=>u.value[n.value]),M=i(()=>n.value===p.value-1),s={steps:u,totalSteps:p,currentStepId:n,currentStep:h,isLastStep:M,data:f,progress:x,errors:m(r),loading:m(o),complete:m(v),getStep:l,getNextStep:w,getPrevStep:j,goToStep:d,reset:P,setErrorMessage:A,setFieldError:k,resetFieldError:y,validateStep:S,handleSubmit:B,checkPreviousSteps:R};function w(e=n.value){return l(e+1)}function j(e=n.value){return l(e-1)}function l(e=n.value){return u.value[e]}async function d(e){e&&await g.push(e.to)}function k(e,t){r.value.fields[e]=t}function y(e){Array.isArray(e)?e.forEach(t=>{r.value.fields[t]=void 0}):e?r.value.fields[e]=void 0:r.value.fields={}}function A(e=""){r.value.message=e}async function S(e=h.value){if(e.validate)try{const t=await e.validate(s),I=Object.values(r.value.fields).filter(Boolean).length>0||r.value.message;if(t===!1||I)return!1}catch(t){return a.onError&&await a.onError(t,s),!1}return!0}function P(e=a.initialState){f.value=E(b(e)),o.value=!1,v.value=!1,r.value={message:"",fields:{}}}async function R(){let e=0;for(;e<n.value;){const t=l(e);if(!t)break;if(!await S(t)){await d(t);return}e++}}async function B(){if(o.value)return;if(o.value=!0,y(),!await S()){o.value=!1;return}const e=w();if(e){await d(e),o.value=!1;return}try{a.onSubmit&&await a.onSubmit(f.value,s),v.value=!0}catch(t){a.onError&&await a.onError(t,s)}finally{o.value=!1}}return L(F,s),s}function U(){const a=N(F,null);if(!a)throw new Error("MultiStepForm: هیچ متنی یافت نشد، آیا فراموش کرده‌اید provideMultiStepForm را فراخوانی کنید؟");return a}export{T as p,U as u};
